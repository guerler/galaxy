define("mvc/visualization/chart/components/screenshot",[],function(){"use strict";define(["libs/underscore"],function(t){function e(t){try{if(0!==t.width()&&0!==t.height()){var e=function t(e,a,r){var o=e.prop("tagName").toLowerCase(),s=e.position(),c=a+s.left+parseInt(e.css("marginLeft"),10)+parseInt(e.css("borderLeftWidth"),10)+parseInt(e.css("paddingLeft"),10),h=r+s.top+parseInt(e.css("marginTop"),10)+parseInt(e.css("borderTopWidth"),10)+parseInt(e.css("paddingTop"),10);n.width;"div"==o||"span"==o?e.children().each(function(){t($(this),c,h)}):"canvas"==o&&i.drawImage(e[0],c,h)},n=document.createElement("canvas");n.width=t.outerWidth(!0),n.height=t.outerHeight(!0);var i=n.getContext("2d");i.save(),i.fillStyle="rgb(255,255,255)",i.fillRect(0,0,n.width,n.height),i.restore(),i.translate(0,0),i.textAlign="left",i.textBaseline="top",t.children().each(function(){e($(this),0,0)});var a=n.toDataURL("image/png");a&&(window.location.href=a.replace("image/png","image/octet-stream"))}}catch(t){console.debug("FAILED - screenshot::_canvas2png() - "+t),options.error&&options.error("Please reduce your visualization to a single panel and try again.")}}function n(t){var e=i(t),n=document.createElement("canvas"),a=n.getContext("2d"),r=new Image,o=$('<div style="display:none;"/>').append($(n));$("body").append(o),n.width=5*e.width,n.height=5*e.height,r.src="data:image/svg+xml;base64,"+btoa(e.string),r.onload=function(){a.drawImage(r,0,0,n.width,n.height),window.location.href=n.toDataURL("image/png").replace("image/png","image/octet-stream"),o.remove()}}function i(t){var e=t.$el.find("svg");{if(0!=e.length||!t.error){t.$el;var n=e.length,i=parseInt(e.first().css("height")),r=parseInt(e.first().css("width")),o=new XMLSerializer,s=$("<svg/>").attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:r*n,height:i}),c=0;return e.each(function(){var t=$(this).clone();a(t);var e=$('<g transform="translate('+c+', 0)">').attr("xmlns","http://www.w3.org/2000/svg");e.append(t.find("g").first()),s.append(e),c+=r}),{string:o.serializeToString(s[0]),height:i,width:r}}t.error("No SVG found. This visualization type does not support SVG/PDF export.")}}function a(t){for(var e in document.styleSheets){var n=document.styleSheets[e].cssRules;if(n)for(var i=0,a=n.length;i<a;i++)try{t.find(n[i].selectorText).each(function(t,e){e.style.cssText+=n[i].style.cssText})}catch(t){}}}return{createPNG:function(t){t.$el.find("svg").length>0?n(t):e(t.$el.find(".charts-viewport-canvas"))},createSVG:function(t){window.location.href="data:none/none;base64,"+btoa(i(t).string)},createPDF:function(t){var e=i(t),n={filename:"visualization",type:"application/pdf",height:e.height,width:e.width,scale:2,svg:e.string},a=$("body"),r=a.find("#viewport-form");0===r.length&&(r=$("<form>",{id:"viewport-form",method:"post",action:"http://export.highcharts.com/",display:"none"}),a.append(r)),r.empty();for(var o in n){var s=$("<input/>",{type:"hidden",name:o,value:n[o]});r.append(s)}try{r.submit()}catch(t){console.log(t)}}}})});